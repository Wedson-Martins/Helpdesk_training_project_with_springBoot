<!DOCTYPE html>
<html xmlns:th="http://thymeleaf.org"
	xmlns:layout="http://ultraq.net.nz.thymeleaf.layout"
	layout:decorator="layout">

<th:block layout:fragment="content">
	<div class="container ">
		<div class="mb-3"></div>
		<div class="card col-8">
			<div class="card-header">Edit a Ticket</div>
			<div class="card-block">
				<div class="container">
					<form th:action="@{/tickets/{id}(id=${ticket.id})}"
						th:object="${ticket}" th:method="put">
						<div class="row">
							<div class="m-3">
								<input placeholder="Name" class="form-control"
									th:field="*{name}" /> <span th:if="${#fields.hasErrors()}"
									th:errors="*{name}" class="text-danger">Error</span>
							</div>
						</div>
						<div class="row">
							<div class="m-3">
								<textarea placeholder="Enter Ticket" class="form-control"
									th:field="*{description}" name="description"></textarea>

								<span th:if="${#fields.hasErrors()}" th:errors="*{description}"
									class="text-danger">Error</span>
							</div>
						</div>

							<div class="form-group">
								<select th:field="*{technician}" class="custom-select">
									<option th:each="tech : ${techs}" 
										    th:value="${tech.id}"
										    th:text=${tech.name}>
									</option>
								</select>
							</div>
						<!-- 		<p th:text="${userLoggedIn.id}"></p>
								<p th:text="${ticket.userOpen.id}"></p>
								<p th:text="${userLoggedIn.roles[0].name}"></p> -->
						<div class="form-group" th:if="${interactionsSize > 0}">
							<label class="custom-control custom-checkbox" th:if="${userLoggedIn.id == ticket.userOpen.id or userLoggedIn.roles[0].name == 'ADMIN'}" > 
						
								<input type="checkbox" class="custom-control-input"
									th:field="*{finished}" 
									th:checked="${ticket.finished}"/> 
								<span class="custom-control-indicator"></span> 
								<span class="custom-control-description">Closed?</span>
							</label>
						</div>

						<div class="form-group" th:if="${interactionsSize == 0}">
							<p class="text-danger">Need at least one interaction to close
								this.ticket</p>
						</div>

						<div class="row">
							<div class="m-3">
								<input type="submit" class="btn btn-primary" value="Update" th:if="${userLoggedIn.id == ticket.userOpen.id or userLoggedIn.roles[0].name == 'ADMIN'}" ></input>
								<a href="/tickets" class="btn btn-secondary">Back</a>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
</th:block>
</html>
